{"version":3,"sources":["assets\\Scripts\\ServerCom.js"],"names":["Cookies","require","root","window","cc","Class","Component","properties","loading","type","Node","reconnecting","tracker","errorLable","Label","loginErrorNode","trackerCount","timer","onLoad","ServerCom","checkOrientation","view","on","winSize","width","height","setOrientation","macro","ORIENTATION_LANDSCAPE","ORIENTATION_PORTRAIT","error","console","clearTracker","httpRequest","method","address","data","callback","timeout","inst","xhr","XMLHttpRequest","active","onreadystatechange","K","internetAvailable","readyState","response","responseText","status","undefined","JSON","parse","errorMsg","errorData","log","string","setTimeout","e","onerror","err","ontimeout","disconnectRequestedByPlayer","emit","code","Error","TimeOutError","open","setRequestHeader","token","sys","isBrowser","cookies","document","cookie","split","i","length","trim","startsWith","substring","send","stringify"],"mappings":"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","sourceRoot":"/","sourcesContent":["const Cookies = require('js-cookies');\r\n// const axios = require('./axios/dist/axios');\r\n// const axios = require('axios');\r\n\r\nvar root = window;\r\ncc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        loading: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        reconnecting: {\r\n            default: null,\r\n            type: cc.Node,\r\n        },\r\n        tracker: {\r\n            default: {},\r\n        },\r\n        errorLable:{\r\n            default: null,\r\n            type:cc.Label\r\n        },\r\n        loginErrorNode:{\r\n            default: null,\r\n            type: cc.Node\r\n        },\r\n        trackerCount: 0,\r\n        timer : 0,\r\n    },\r\n    // LIFE-CYCLE CALLBACKS:\r\n    onLoad() {\r\n        // Created ServerCom Gloabaly so that we can access it anywhere we want\r\n        root.ServerCom = this;\r\n        this.checkOrientation();\r\n        // Add event listener for canvas resize to handle orientation change\r\n        cc.view.on('canvas-resize', this.checkOrientation, this);\r\n    },\r\n    // following function is to check the width and change the orientation(Landscape/Potrait) for mobile or dekstop\r\n    checkOrientation() {\r\n        try {\r\n            let winSize = cc.winSize;\r\n            // Check if the width is greater than the height to determine orientation\r\n            if (winSize.width > winSize.height) {\r\n                cc.view.setOrientation(cc.macro.ORIENTATION_LANDSCAPE);\r\n            } else {\r\n                cc.view.setOrientation(cc.macro.ORIENTATION_PORTRAIT);\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error checking orientation:\", error);\r\n        }\r\n    },\r\n    clearTracker: function(){\r\n        this.trackerCount = 0;\r\n        this.tracker = {};\r\n    },\r\n\r\n    /**\r\n     * @method httpPostRequest\r\n     * @description HTTP request - POST data \r\n     * @param {String} address -address of Server \r\n     * @param {Object} data -Data/PayLoad to be sent\r\n     * @param {method} callback -Callback to be executed if response.succss is true!\r\n     * @param {method} error -Callback to be executed if response.success is false!\r\n     * @param {Number} timeout -value in milli seconds, Specify request timeout time! \r\n     * @memberof Utilities.ServerCom#\r\n     */\r\n\r\n \r\n    httpRequest: function (method, address, data, callback, error, timeout) {\r\n        var inst = this;\r\n        var xhr = new XMLHttpRequest();\r\n        xhr.timeout = timeout || 1000;\r\n        if(!ServerCom.loading.active){\r\n            ServerCom.loading.active = true;\r\n        }\r\n        xhr.onreadystatechange = function () {\r\n            K.internetAvailable = true;\r\n            if (xhr.readyState == 4) {\r\n                ServerCom.loading.active = false;\r\n                var response = xhr.responseText;\r\n                if (xhr.status >= 200 && xhr.status < 400) {\r\n                    if (callback !== null && callback !== undefined) {\r\n                        var data = JSON.parse(response);\r\n                            callback(data);\r\n                    }\r\n                } else {\r\n                    var errorMsg = \"Unknown error\";\r\n                    try {\r\n                        var errorData = JSON.parse(response);\r\n                        if (errorData.error) {\r\n                            errorMsg = errorData.error;\r\n                        }\r\n                        console.log(\"errorDataerrorData\", errorData, xhr);\r\n                        inst.errorLable.string = errorData.error\r\n                        inst.loginErrorNode.active = true;\r\n                        setTimeout(() => {\r\n                            inst.loginErrorNode.active = false;\r\n                        }, 2000);\r\n                        // callback(errorData);\r\n                    } catch (e) {\r\n                        console.error(\"Error parsing error response:\", e);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n    \r\n        xhr.onerror = function (err) {\r\n            ServerCom.loading.active = false;\r\n            K.internetAvailable = false;\r\n    \r\n            var errorMsg = \"Unknown error\";\r\n            try {\r\n                var errorData = JSON.parse(xhr.responseText);\r\n                if (errorData.error) {\r\n                    errorMsg = errorData.error;\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error parsing error response:\", e);\r\n            }\r\n        };\r\n    \r\n        xhr.ontimeout = function () {\r\n            ServerCom.loading.active = false;\r\n            K.disconnectRequestedByPlayer = false;\r\n            K.internetAvailable = false;\r\n            // \r\n            inst.emit('error', {\r\n                code: K.Error.TimeOutError,\r\n                response: \"Timeout \" + address,\r\n            });\r\n        };\r\n        // \r\n        // xhr.withCredentials = true;\r\n        xhr.open(method, address, true);\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        let token = null;\r\n        if (!token && cc.sys.isBrowser) {\r\n            const cookies = document.cookie.split(';');\r\n            for (let i = 0; i < cookies.length; i++) {\r\n                const cookie = cookies[i].trim();\r\n                if (cookie.startsWith('token=')) {\r\n                    token = cookie.substring('token='.length, cookie.length);\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        // If token exists, add it to a custom header\r\n        if (token) {\r\n            xhr.setRequestHeader(\"Cookie\", `userToken=${token}`);\r\n        }\r\n        if (method === \"POST\") {\r\n            xhr.send(JSON.stringify(data));\r\n        } else if (method === \"GET\") {\r\n            xhr.send();\r\n        }\r\n    },\r\n\r\n    \r\n    // WILL use the following code later to check if the same api is request untill we gets its response\r\n    // /**\r\n    // updateTracker: function (val, key, showLoading) {\r\n    //     var incr = val ? +1 : -1;\r\n    //     this.trackerCount = this.trackerCount + incr;\r\n    //     var isActive = val && showLoading;\r\n    //     if(!this.loading.active && showLoading){\r\n    //         this.loading.active = true; \r\n    //     }else if(this.loading.active && !showLoading) {\r\n    //         this.loading.active = false;\r\n    //     }\r\n    //     //this.loading.active = val && showLoading;\r\n    //     this.tracker[key] = val;\r\n    // },\r\n\r\n});"]}